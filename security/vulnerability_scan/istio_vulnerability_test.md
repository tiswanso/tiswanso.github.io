# Vulnerability Testing Istio

## Approaches

The goal is to validate Istio deployments on Kubernetes and distributed packages for security vulnerabilities.  Validating
Kubernetes control-plane components and container runtime environments is NOT a goal.

To vulnerability test Istio components, the approach is to setup vulnerability test tools to treat Istio control-plane
pods as endpoints to validate.  This requires setting up testbeds to give the tools IP access directly to the Istio
Kubernetes pods.

### Tool Deployment

#### Kali Container

A container was built from the `kalilinux/kali-linux-docker` base with testssl.sh installed.  The
details on how it was built are as follows:

1. Dockerfile:

   ```
   FROM kalilinux/kali-linux-docker

   RUN  apt-get update && \
        apt-get install --no-install-recommends -y \
          kali-linux-web \
          dnsutils \
          net-tools \
          &&  apt-get upgrade -y

   ADD testssl.sh /usr/bin/
   ```

1. Build:  `docker build -f Dockerfile.kali -t tiswanso/kali_testssl:latest .`

1. Push:  `docker push tiswanso/kali_testssl:latest`

1. K8s manifest for use within a k8s cluster with Istio, [sec_kali.yaml](security/vulnerability_scan/sec_kali.yaml)

1. Install in a namespace WITHOUT auto-sidecar injection:

   ```
   kubectl apply -f sec_kali.yaml
   ```

## Port Scanning

### nmap
The `nmap` utility is built into the kali container and has various scanning capabilities.  The following
procedure explains how to scan Istio pods for open ports.

### Procedure

1. Get IPs of all Istio pods

1. Scan all ports for each IP with `nmap`

   1. Example for pilot pod IP (run from within the `testkali` container):

      ```
      $ nmap -p- 192.170.154.232
      Starting Nmap 7.70 ( https://nmap.org ) at 2018-08-31 02:37 UTC
      Nmap scan report for 192.170.154.232
      Host is up (0.000034s latency).
      Not shown: 65527 closed ports
      PORT      STATE SERVICE
      8080/tcp  open  http-proxy
      9093/tcp  open  copycat
      15003/tcp open  unknown
      15005/tcp open  unknown
      15007/tcp open  unknown
      15010/tcp open  unknown
      15011/tcp open  unknown
      15012/tcp open  unknown
      ```

1. Get info and SSL ciphers for each open port:

   ```
   $ nmap -Pn -p9093 -sV --script=+http-headers,+ssl-enum-ciphers istio-citadel.istio-system.svc.cluster.local
   Starting Nmap 7.70 ( https://nmap.org ) at 2018-09-11 16:50 UTC
   Nmap scan report for istio-citadel.istio-system.svc.cluster.local (10.110.0.3)
   Host is up (0.00016s latency).
   
   PORT     STATE SERVICE VERSION
   9093/tcp open  http    Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
   | http-headers: 
   |   Content-Type: text/plain; charset=utf-8
   |   X-Content-Type-Options: nosniff
   |   Date: Tue, 11 Sep 2018 16:50:39 GMT
   |   Content-Length: 19
   |   Connection: close
   |   
   |_  (Request type: GET)
   ```

## TLS/SSL Validation

### testssl.sh

The [testssl.sh](https://testssl.sh/) performs various SSL/TLS operations against a target to check
against known CVEs and misconfiguration issues.  It also displays various discovered information
from the TLS handshake, including but not limited to:

    * server x.509 certificate information
    * available cipher suites
    * negotiated protocol

#### Usage scenarios

Run the testssl.sh tool against each open port for each component.  The following is run from within the
`testkali` container.

##### Check Pilot

 `testssl.sh --warnings off istio-pilot.istio-system.svc.cluster.local:15010`
 `testssl.sh --warnings off istio-pilot.istio-system.svc.cluster.local:15011`

##### Check Citadel

`testssl.sh --warnings off istio-citadel.istio-system.svc.cluster.local:8060`



### Manual

#### Certificate chain

```
# openssl s_client -showcerts -cert /etc/certs/cert-chain.pem -key /etc/certs/key.pem -connect istio-pilot.istio-system.svc.cluster.local:15011
CONNECTED(00000003)
depth=0 O = 
verify error:num=20:unable to get local issuer certificate
verify return:1
depth=0 O = 
verify error:num=21:unable to verify the first certificate
verify return:1
---
Certificate chain
 0 s:/O=
   i:/O=k8s.cluster.local
-----BEGIN CERTIFICATE-----
MIIDRTCCAi2gAwIBAgIRAPrs+2Sc3cOcwsUfJ6dKkYowDQYJKoZIhvcNAQELBQAw
HDEaMBgGA1UEChMRazhzLmNsdXN0ZXIubG9jYWwwHhcNMTgwODA3MTkwNjI5WhcN
MTgxMTA1MTkwNjI5WjALMQkwBwYDVQQKEwAwggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQDOkds/pyt60ifTcNnWbPJB7j6e011QYxnIWbP5c4ifoTaiQy2P
LvAKpU0sBG0MESVYnjwB6XxYPjBazSCXoAImLC9kodfFFtpY4Aq3skt9GLcU7ucT
qmInLzK2bIyn8NuisMhvMAcFhq88sQ174BV+Ba+iFq2KAS0rmMq0jn4vQxPdXBzl
MUqEvD7CuOowoCq/P92QBafZNTYvm6JgPo1n85Qk1qoP8W9NJOnf2qiQPVcfZKeo
SZEPScZF1XaQ3JaaEBbqSzJY19qf5hkrnDD4k1bxfrdrWz4tt7rO6p3LtBG+/ceY
jNRck/vuWvUC03hcMxF/js9ArrhUTtEOQu+HAgMBAAGjgZIwgY8wDgYDVR0PAQH/
BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8E
AjAAMFAGA1UdEQRJMEeGRXNwaWZmZTovL2NsdXN0ZXIubG9jYWwvbnMvaXN0aW8t
c3lzdGVtL3NhL2lzdGlvLXBpbG90LXNlcnZpY2UtYWNjb3VudDANBgkqhkiG9w0B
AQsFAAOCAQEApx6njNxpObtWVGQ0gLR4AIpSUfJkifhhS9zsN5UXB2TnT/rDZntb
cdVhY6ILKHQUndG7GTbtIPk7Lfu/BGv3HqVxNrbfAZhado2B9jwtY/TgU2m3Aofq
j5O7QhAoJ2/TahLu1KrY3NIW8rilcdZDQxPiOzXLJbCkrILQb3LPTKl1pe710jBq
S+VOS7ksphlla5btzXh06RUQvVRdLc2Ecq73T7kfcTF4tLH7665GyzMrum1Vppp7
enPt3sFmOKrMzwjzITmMslfyPMMTDAHD2Sjuaq6b03tC6JV0cRCSg9QOTZR4n5sM
NjZVMo8r9LtpW/3zf/R6rGIuWPMwEho8MQ==
-----END CERTIFICATE-----
---
Server certificate
subject=/O=
issuer=/O=k8s.cluster.local
---
Acceptable client certificate CA names
/O=k8s.cluster.local
Client Certificate Types: RSA sign, ECDSA sign
Requested Signature Algorithms: ECDSA+SHA256:0x04+0x08:RSA+SHA256:ECDSA+SHA384:0x05+0x08:RSA+SHA384:0x06+0x08:RSA+SHA512:RSA+SHA1
Shared Requested Signature Algorithms: ECDSA+SHA256:RSA+SHA256:ECDSA+SHA384:RSA+SHA384:RSA+SHA512:RSA+SHA1
Peer signing digest: SHA256
Server Temp Key: ECDH, P-256, 256 bits
---
SSL handshake has read 2423 bytes and written 1529 bytes
---
New, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES128-GCM-SHA256
Server public key is 2048 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : ECDHE-RSA-AES128-GCM-SHA256
    Session-ID: D72493EDE3F899940818E25C2F4CA9DEF2787DF4FAB65FFFF7EF13952B4749DD
    Session-ID-ctx: 
    Master-Key: F88F4C35BA2ED15087E7FB4737ACBFBF64FC42EB29369A30BD46697CE9DDC453FE7880382FD55271B1AC2DE3AD586DBB
    Key-Arg   : None
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    TLS session ticket lifetime hint: 7200 (seconds)
    TLS session ticket:
    0000 - d7 32 b0 0b bc 81 f2 c7-8a c7 41 3d ea 4c f0 9d   .2........A=.L..
    0010 - 4c 2b 60 a5 53 2b 92 c0-cd 73 61 44 8f 43 b6 9a   L+`.S+...saD.C..
    0020 - d9 13 0f d0 91 32 2c 9c-76 7d fa 1c f6 b1 08 9d   .....2,.v}......
    0030 - 5e 33 ae c4 c5 d0 a0 18-87 c5 bf d4 e0 e2 1b 97   ^3..............
    0040 - 83 0e a8 ba ac 9e 68 ce-51 49 75 4a 63 67 57 d6   ......h.QIuJcgW.
    0050 - 82 70 31 bd ff 74 66 4d-0b 85 47 23 82 1d 41 85   .p1..tfM..G#..A.
    0060 - 59 17 54 1c 89 20 cf de-45 ef 63 34 a3 28 7e 14   Y.T.. ..E.c4.(~.
    0070 - 1a 11 ff 17 b6 cd 5b 3c-98 59 56 1d 71 bc a9 37   ......[<.YV.q..7
    0080 - 5e 20 d2 db 84 bb 65 f1-83 c6 f3 c0 75 9e af 49   ^ ....e.....u..I
    0090 - e0 19 2b 34 76 b7 c7 47-8b fb da 73 99 b3 03 8b   ..+4v..G...s....
    00a0 - 88 80 24 f2 74 df a1 02-08 36 e9 b7 f5 9f 9a cd   ..$.t....6......
    00b0 - 34 02 b1 d6 b4 12 36 77-8c c4 ec c0 ff 75 f9 3e   4.....6w.....u.>
    00c0 - bc 11 d4 66 35 06 7e ba-d6 80 52 83 99 ae 97 39   ...f5.~...R....9
    00d0 - 83 23 2b d8 74 1c cf e7-45 82 b5 31 d8 aa e5 fb   .#+.t...E..1....
    00e0 - 78 39 a9 4a 19 05 46 c8-cf a6 e9 46 63 16 c4 1e   x9.J..F....Fc...
    00f0 - 2f e9 45 34 46 ec 2f 52-fd 7f 5c 9d 51 14 1f 26   /.E4F./R..\.Q..&
    0100 - da 24 79 29 08 e4 1c cb-14 4d 26 e6 c3 ed ab 83   .$y).....M&.....
    0110 - b0 c7 1c 83 65 29 d7 c6-f9 c0 47 49 47 db bc 13   ....e)....GIG...
    0120 - d0 ea be 79 ae 6b 51 9b-83 f5 78 e1 78 ec 33 29   ...y.kQ...x.x.3)
    0130 - 2a 1e 04 cd 7f 89 2f 62-c5 9b b8 a9 5e 4e 0f dd   *...../b....^N..
    0140 - 4c e7 aa 87 f2 1a bb 5c-f5 1c 81 f1 e1 8e e8 c4   L......\........
    0150 - 1c 05 d1 c7 30 6f 9b 20-d0 52 9e b1 25 03 1b 12   ....0o. .R..%...
    0160 - f9 97 0b 3e 05 13 f5 b0-8a 9f b7 96 f5 6c 7d c7   ...>.........l}.
    0170 - 00 8b 0c cc 5d d8 5a 34-4c 8f 42 da 97 ca c2 46   ....].Z4L.B....F
    0180 - 84 5b 13 6c 6c fa d7 d9-74 35 81 97 bb cc 66 c8   .[.ll...t5....f.
    0190 - 3c e8 4e ec 09 a0 e9 5b-da 82 ab 25 93 00 5f d8   <.N....[...%.._.
    01a0 - d3 1e 80 ed 8d 74 28 24-7d 32 f3 09 66 d1 26 30   .....t($}2..f.&0
    01b0 - 65 dc e5 c5 80 e4 6a d1-08 c7 bf ba a0 1e 49 60   e.....j.......I`
    01c0 - 47 9b 7b d6 67 1a e5 13-85 6f 7c 3d 1a 99 c4 31   G.{.g....o|=...1
    01d0 - dd e9 c7 8d f7 5e d7 a8-b4 e4 f4 25 9c 7b ff f3   .....^.....%.{..
    01e0 - 3f 47 9e 02 24 63 07 cc-fa f7 3c f3 3c 98 09 8d   ?G..$c....<.<...
    01f0 - 2f 4c 69 ca e4 77 d9 9f-9f 7b 72 f4 96 5d be bd   /Li..w...{r..]..
    0200 - 66 f0 55 7e 62 a9 a4 2f-3d 3b 8c a4 95 eb aa 5b   f.U~b../=;.....[
    0210 - c2 d6 1a ee b9 0f d1 5e-c5 dc 22 c0 ec 78 10 01   .......^.."..x..
    0220 - 4c fe 6e 7e 57 a9 ee b5-2d 77 26 29 71 70 6a 06   L.n~W...-w&)qpj.
    0230 - b1 f1 64 08 75 55 29 2e-5e eb 55 92 6d bb ff 0e   ..d.uU).^.U.m...
    0240 - 34 17 1c d2 c5 84 17 e5-02 7d 26 9b 9b db 7b fd   4........}&...{.
    0250 - ce 7f c2 a8 3f f7 39 bb-5d 3a d5 18 ef 17 dd 84   ....?.9.]:......
    0260 - e1 7e 4b ae 31 af be 28-b6 73 f8 ad e3 0d c9 ce   .~K.1..(.s......
    0270 - 36 cb 3f 39 a1 7c 08 04-70 02 a0 94 06 ca 5d b1   6.?9.|..p.....].
    0280 - 88 83 70 f4 3c 2e 2a 8f-c7 a8 81 97 5b 90 de 03   ..p.<.*.....[...
    0290 - 0b 8c 02 55 44 1a b4 f7-87 a5 f0 65 b3 c2 4b 10   ...UD......e..K.
    02a0 - 03 cb d8 d9 9f f6 00 a4-ed bc 75 45 9e 0c 5b 8b   ..........uE..[.
    02b0 - e6 98 df 58 80 8e f5 a5-8f be 0a 8d a2 c4 3c 5e   ...X..........<^
    02c0 - c5 9b 66 23 e6 13 81 80-c6 30 f8 6a 21 d1 ff 2c   ..f#.....0.j!..,
    02d0 - 60 37 36 97 06 d6 26 fa-f4 ac d4 17 58 0e b0 9c   `76...&.....X...
    02e0 - f5 2d 12 f7 89 8c 30 51-0f c8 07 f9 bf 9d 91 d5   .-....0Q........
    02f0 - 17 34 3a 33 7b c8 f4 17-c3 31 67 1a 48 8e 50 c4   .4:3{....1g.H.P.
    0300 - 9f 02 aa a9 32 96 86 b7-21 c7 e4 e4 8c 85 fd 4a   ....2...!......J
    0310 - a5 ee ab b6 4e 8d e4 10-3e 52 cf 52 9e 9b e6 55   ....N...>R.R...U
    0320 - 54 5e cf df ed 99 49 a4-86 ba dd 34 2e a0 dd b4   T^....I....4....
    0330 - e0 2a b8 89 3d 49 c5 48-64 f1 16 78 9c a2 f7 eb   .*..=I.Hd..x....
    0340 - 7a 34 e0 fb 93 75 d7 35-31 bb 2e 50 fe 42 77 87   z4...u.51..P.Bw.
    0350 - 58 64 d4 8c cd 96 cd 0e-9a 25 f1 1b 9c 86 04 10   Xd.......%......
    0360 - f3 ed dc 19 15 29 6e 95-46 be b9 f9 7a 0f db df   .....)n.F...z...
    0370 - c0 6b 64 71 20 48 32 1f-13 38 fb f7 37 4b 82 2b   .kdq H2..8..7K.+
    0380 - b2 e7 4f 9d 8f 24 6c c6-ac c1 e0 7a b8 6e 2a fd   ..O..$l....z.n*.
    0390 - a2 e4 79 0d d0 a1 dc 5b-f4 40 af 7e a2 0c 82 f0   ..y....[.@.~....
    03a0 - 8e f9 9f 63 22 5d d9 bb-48 01 46 83 ee 4f b4 d7   ...c"]..H.F..O..
    03b0 - 84 6a 6d 5a 91 d9 72 b7-43 d4 cf 74 a6 11 80 f1   .jmZ..r.C..t....
    03c0 - bf 9f 3b 2c 5f 34 9e a3-df ba ac 72 be ef b6 e8   ..;,_4.....r....
    03d0 - 9f ce 6d 60 39 e1 85 19-44 54 89 ab 9e a3 f5 c2   ..m`9...DT......
    03e0 - 6d b2 44 38 e3 cb d3 26-1f eb 5b e6 de d1 2a 80   m.D8...&..[...*.
    03f0 - cc 73 83 40 00 4d 24 21-8f e1 fe 1c ed a2 aa 6f   .s.@.M$!.......o

    Start Time: 1533698431
    Timeout   : 300 (sec)
    Verify return code: 21 (unable to verify the first certificate)
---
```

#### Cipher suites

```
root@testkali-5bfcbc47b5-vdw94:/# nmap --script ssl-enum-ciphers -p 15011 -Pn istio-pilot.istio-system.svc.cluster.local
Starting Nmap 7.70 ( https://nmap.org ) at 2018-09-05 19:50 UTC
Nmap scan report for istio-pilot.istio-system.svc.cluster.local (10.110.0.93)
Host is up (0.00016s latency).

PORT      STATE SERVICE
15011/tcp open  unknown
| ssl-enum-ciphers: 
|   TLSv1.0: 
|     ciphers: 
|       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA (ecdh_x25519) - A
|       TLS_RSA_WITH_AES_128_CBC_SHA (rsa 2048) - A
|       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (ecdh_x25519) - A
|       TLS_RSA_WITH_AES_256_CBC_SHA (rsa 2048) - A
|     compressors: 
|       NULL
|     cipher preference: server
|   TLSv1.1: 
|     ciphers: 
|       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA (ecdh_x25519) - A
|       TLS_RSA_WITH_AES_128_CBC_SHA (rsa 2048) - A
|       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (ecdh_x25519) - A
|       TLS_RSA_WITH_AES_256_CBC_SHA (rsa 2048) - A
|     compressors: 
|       NULL
|     cipher preference: server
|   TLSv1.2: 
|     ciphers: 
|       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA (ecdh_x25519) - A
|       TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (ecdh_x25519) - A
|       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (ecdh_x25519) - A
|       TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (ecdh_x25519) - A
|       TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 (ecdh_x25519) - A
|       TLS_RSA_WITH_AES_128_CBC_SHA (rsa 2048) - A
|       TLS_RSA_WITH_AES_128_GCM_SHA256 (rsa 2048) - A
|       TLS_RSA_WITH_AES_256_CBC_SHA (rsa 2048) - A
|       TLS_RSA_WITH_AES_256_GCM_SHA384 (rsa 2048) - A
|     compressors: 
|       NULL
|     cipher preference: client
|_  least strength: A

Nmap done: 1 IP address (1 host up) scanned in 0.52 seconds
```

#### Server Certificate Info

```
root@testkali-5bfcbc47b5-vdw94:/# echo | openssl s_client -showcerts -servername istio-pilot.istio-system.svc.cluster.local -connect istio-pilot.istio-system.svc.cluster.local:15011 2>/dev/null | openssl x509 -inform pem -noout -text
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            fa:ec:fb:64:9c:dd:c3:9c:c2:c5:1f:27:a7:4a:91:8a
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: O = k8s.cluster.local
        Validity
            Not Before: Aug  7 19:06:29 2018 GMT
            Not After : Nov  5 19:06:29 2018 GMT
        Subject: O = 
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:ce:91:db:3f:a7:2b:7a:d2:27:d3:70:d9:d6:6c:
                    f2:41:ee:3e:9e:d3:5d:50:63:19:c8:59:b3:f9:73:
                    88:9f:a1:36:a2:43:2d:8f:2e:f0:0a:a5:4d:2c:04:
                    6d:0c:11:25:58:9e:3c:01:e9:7c:58:3e:30:5a:cd:
                    20:97:a0:02:26:2c:2f:64:a1:d7:c5:16:da:58:e0:
                    0a:b7:b2:4b:7d:18:b7:14:ee:e7:13:aa:62:27:2f:
                    32:b6:6c:8c:a7:f0:db:a2:b0:c8:6f:30:07:05:86:
                    af:3c:b1:0d:7b:e0:15:7e:05:af:a2:16:ad:8a:01:
                    2d:2b:98:ca:b4:8e:7e:2f:43:13:dd:5c:1c:e5:31:
                    4a:84:bc:3e:c2:b8:ea:30:a0:2a:bf:3f:dd:90:05:
                    a7:d9:35:36:2f:9b:a2:60:3e:8d:67:f3:94:24:d6:
                    aa:0f:f1:6f:4d:24:e9:df:da:a8:90:3d:57:1f:64:
                    a7:a8:49:91:0f:49:c6:45:d5:76:90:dc:96:9a:10:
                    16:ea:4b:32:58:d7:da:9f:e6:19:2b:9c:30:f8:93:
                    56:f1:7e:b7:6b:5b:3e:2d:b7:ba:ce:ea:9d:cb:b4:
                    11:be:fd:c7:98:8c:d4:5c:93:fb:ee:5a:f5:02:d3:
                    78:5c:33:11:7f:8e:cf:40:ae:b8:54:4e:d1:0e:42:
                    ef:87
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Subject Alternative Name: 
                URI:spiffe://cluster.local/ns/istio-system/sa/istio-pilot-service-account
    Signature Algorithm: sha256WithRSAEncryption
         a7:1e:a7:8c:dc:69:39:bb:56:54:64:34:80:b4:78:00:8a:52:
         51:f2:64:89:f8:61:4b:dc:ec:37:95:17:07:64:e7:4f:fa:c3:
         66:7b:5b:71:d5:61:63:a2:0b:28:74:14:9d:d1:bb:19:36:ed:
         20:f9:3b:2d:fb:bf:04:6b:f7:1e:a5:71:36:b6:df:01:98:5a:
         76:8d:81:f6:3c:2d:63:f4:e0:53:69:b7:02:87:ea:8f:93:bb:
         42:10:28:27:6f:d3:6a:12:ee:d4:aa:d8:dc:d2:16:f2:b8:a5:
         71:d6:43:43:13:e2:3b:35:cb:25:b0:a4:ac:82:d0:6f:72:cf:
         4c:a9:75:a5:ee:f5:d2:30:6a:4b:e5:4e:4b:b9:2c:a6:19:65:
         6b:96:ed:cd:78:74:e9:15:10:bd:54:5d:2d:cd:84:72:ae:f7:
         4f:b9:1f:71:31:78:b4:b1:fb:eb:ae:46:cb:33:2b:ba:6d:55:
         a6:9a:7b:7a:73:ed:de:c1:66:38:aa:cc:cf:08:f3:21:39:8c:
         b2:57:f2:3c:c3:13:0c:01:c3:d9:28:ee:6a:ae:9b:d3:7b:42:
         e8:95:74:71:10:92:83:d4:0e:4d:94:78:9f:9b:0c:36:36:55:
         32:8f:2b:f4:bb:69:5b:fd:f3:7f:f4:7a:ac:62:2e:58:f3:30:
         12:1a:3c:31
```

Galley
```
root@bxb-ds-87:~# kubectl exec -it testkali-5bfcbc47b5-vdw94 bash
root@testkali-5bfcbc47b5-vdw94:/# echo | openssl s_client -showcerts -servername istio-galley.istio-system.svc.cluster.local -connect istio-galley.istio-system.svc.cluster.local:443 2>/dev/null | openssl x509 -inform pem -noout -text
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            bb:28:f7:b4:63:9a:dd:56:79:ba:0e:43:38:44:fc:ea
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: O = k8s.cluster.local
        Validity
            Not Before: Aug  7 19:06:46 2018 GMT
            Not After : Nov  5 19:06:46 2018 GMT
        Subject: O = 
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:c6:e5:58:ba:1c:9f:9b:28:5f:75:02:9d:1e:20:
                    8f:98:b8:2f:87:0d:b7:9b:8f:65:69:19:5b:87:16:
                    7a:e3:52:7a:f7:56:9f:5b:2a:c6:93:6e:5d:9e:cb:
                    7a:76:e6:3c:07:ce:d6:4b:72:d5:54:b6:b6:e0:29:
                    ab:3a:51:a4:20:46:17:50:d2:b5:db:19:29:83:05:
                    86:cf:f3:cf:24:8d:ff:54:95:97:a1:9a:ef:a3:85:
                    42:95:8a:aa:ab:0d:5c:d4:5f:cc:bb:35:db:49:d0:
                    35:47:dd:64:4b:a7:e3:49:75:4b:53:5d:20:2f:43:
                    22:25:48:c6:64:2b:09:c3:35:41:b2:c2:de:c2:97:
                    89:55:75:b0:ee:29:2b:ec:8b:5f:31:98:ec:50:3e:
                    20:4b:43:25:f5:79:34:14:db:11:c3:62:2f:c2:f7:
                    b9:c6:01:09:a9:76:f8:8d:dc:3b:48:5e:55:53:85:
                    cd:0a:4c:1a:2f:83:da:f0:f4:a4:8d:a1:a3:68:e8:
                    34:f5:b2:79:96:67:a1:49:fd:b7:53:60:ed:4d:1d:
                    85:ba:77:37:13:bf:bc:ea:ae:87:a7:45:13:4a:9d:
                    ed:61:72:b7:3c:77:87:78:15:33:07:55:15:22:da:
                    86:8e:2a:3e:c3:7d:2d:22:4f:cb:e7:a8:f1:40:51:
                    a1:25
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Subject Alternative Name: 
                URI:spiffe://cluster.local/ns/istio-system/sa/istio-galley-service-account, DNS:istio-galley.istio-system.svc, DNS:istio-galley.istio-system
    Signature Algorithm: sha256WithRSAEncryption
         34:36:0e:1d:fb:8c:00:74:fa:22:18:51:a7:3d:ed:d4:ae:62:
         4b:8f:fa:e3:fc:0e:1d:6b:55:84:59:4d:b2:03:ff:b2:2c:1d:
         87:bb:9c:aa:d8:11:71:a1:b8:de:fd:ca:29:e9:cc:75:04:cd:
         08:84:8b:bb:20:f4:fe:2b:a9:b7:1d:52:0d:c6:a7:cc:97:1c:
         a5:3e:09:1b:e6:6d:ce:e5:ed:9a:95:04:39:8a:e8:57:83:9a:
         e7:08:e2:c8:50:1c:a2:83:9e:20:20:b0:00:d5:f5:a4:09:c3:
         4a:30:15:fd:d2:dd:f2:62:d6:72:9f:10:17:f6:6b:a4:b7:b7:
         53:ba:d0:66:42:98:12:00:cc:43:44:e0:8b:d6:13:69:ed:cf:
         8c:4d:3c:18:d1:cd:e2:ea:44:f0:3b:94:4a:5f:90:5d:fd:6a:
         b9:99:0a:4c:f7:5c:d8:2f:bf:62:f5:8e:05:f4:49:bb:02:7f:
         68:91:a2:2c:4e:6f:45:fa:ed:d1:b5:49:cb:0a:8e:b6:3f:34:
         f7:ab:fd:38:5a:07:fc:51:52:13:70:68:e6:90:de:5a:9c:0d:
         03:86:92:c0:ee:80:f6:b3:da:7e:43:cd:c4:a6:3a:d7:88:ee:
         4c:68:2f:57:b0:78:03:23:a7:cc:a0:86:ee:73:4a:b8:bc:87:
         c1:51:9d:52
```

NOTE:  `nmap --script ssl-cert` and SSLyze don't seem to like the Istio SPIFFE format x.509 certs.  Likely
this is due to assumptions on the CN and SAN values--with SPIFFE, SVID is in the SAN.

## References

* https://hub.docker.com/r/kalilinux/kali-linux-docker/
* https://testssl.sh/
* (https://github.com/drwetter/testssl.sh/blob/2.9.5/doc/testssl.1.md)
